version: '3'

x-aws-vpc: ${AWS_VPC}

networks:
  base:
volumes:
  db-store:
services:
  nextjs:
    image: ${NEXTJS_IMAGE}
    ports:
      - target: 3000
        x-aws-protocol: http
    networks:
      - base
    environment:
      - ENDPOINT=db
      - DATABASE=ktane
      - USERNAME=root
      - PASSWORD=pwd
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - URL=https://ktane.regularofvanilla.com/
  db:
    image: ${DB_IMAGE}
    ports:
      - target: 3306
        x-aws-protocol: http
    environment:
      - MYSQL_ROOT_PASSWORD=pwd
      - MYSQL_DATABASE=ktane
      - MYSQL_PASSWORD=pwd
    networks:
      - base
    volumes:
      - db-store:/var/lib/mysql